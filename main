from modules.connection import *
from modules.vm import *
from modules.lun import *
from modules.ip import *
from modules.utils import *
import pandas as pd
import ovirtsdk4
import sys

try:
	connection = Connection()
	conn = connection.connection()
	conn.test(raise_exception = True)  # return true if connect successful
	utils = Utils(conn)
except ovirtsdk4.AuthError :
	print('Authentication failed, please check adminrc')
	sys.exit()

path = '/home/centos/rhvm/test_data.xlsx'
data = pd.read_excel(path)
vms = []


for index,row in data.iterrows():
	vm = {}   
	vm['luns'] = []
	vm['ips'] = []	


	pre_vm = next((i for i in vms if i.id == row['id']),None)
	if pre_vm is not None:
		pre_vm.luns.append(LUN(row['os'],row['bootable']))
		continue
	
	vm['luns'].append(LUN(row['os'],row['bootable']))
	vm['ips'].append( nics(row['ip'], row['subnet'], row['gateway'] ))	
	vm['id'] = row['id'] 
	vm['name'] = row['name']
	vm['ram'] = row['ram']
	vm['vcpu'] = row['vcpu']
	vm['cluster'] = 'managed'
	vm['network'] = 'ovirtmgmt'
	vms.append(VM(vm))


for vm in vms:
	utils.create_vm(vm)	

conn.close()

